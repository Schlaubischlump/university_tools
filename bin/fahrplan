#!/usr/bin/env python3
# PYTHON_ARGCOMPLETE_OK

import sys
import argparse
import argcomplete

from universitytools.timetable import get_stations, print_connections


def station_completer(prefix, parsed_args, **kwargs):
    return [station for station in get_stations().keys() if station.startswith(prefix)]


if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="Fahrplanauskunft")
    requiredNamed = parser.add_argument_group('required named arguments')
    requiredNamed.add_argument("-s", "--station", help="Show all connections for this station", type=str, default=None).completer = station_completer
    argcomplete.autocomplete(parser)
    args = parser.parse_args()

    if not args.station:
        print("You must provide a station name.", file=sys.stderr)
        exit()

    try:
        print_connections(args.station)
    except KeyError:
        print(f"Could not find station: {args.station}.", file=sys.stderr)
        exit()
